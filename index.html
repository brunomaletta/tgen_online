<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">
<style>
body{
    background:#1e1e1e;
    color:#ddd;
    font-family:Consolas,monospace;
    max-width:1000px;
    margin:auto;
    padding:30px;
}
.editor{
    background:#252526;
    border-radius:10px;
    padding:15px;
    box-shadow:0 0 20px #0008;
    position: relative;   /* <-- IMPORTANT */
}
textarea{
    width:100%;
    height:260px;
    background:#1e1e1e;
    color:#9cdcfe;
    border:none;
    outline:none;
    resize:none;
    font-size:14px;
}
button{
    margin-top:15px;
    padding:10px 20px;
    background:#0e639c;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
button:hover{background:#1177bb;}
.output{
    background:#000;
    color:#00ff90;
    padding:15px;
    border-radius:10px;
    margin-top:20px;
    min-height:120px;
    white-space:pre-wrap;
}
.keyword{color:#569cd6;}
textarea{
width:100%;
height:260px;
background:#1e1e1e;
color:#9cdcfe;
border:none;
outline:none;
resize:none;
font-size:14px;
box-sizing:border-box;
}

.codebody{
margin-left:32px;
}

.code-line{
color:#dcdcaa;
margin:6px 0;
}

.spacer{
height:12px;
}

#stringBoxContainer {
    position: absolute;
    top: 12px;
    right: 12px;
    z-index: 1000;
}

#stringBox {
    padding: 6px 10px;
    font-size: 16px;
    width: 180px;
}



</style>
</head>

<body>

<h2>tgen playground</h2>



<div class="editor">

<div id="stringBoxContainer">
    <input id="stringBox" type="text" value="./a.out" />
</div>

<span class="keyword">#include</span> <iostream><br>
<br>
<span class="keyword">#include</span> "tgen.h";<br><br>

<span class="keyword">int</span> main() {<br>

<div class="codebody">

<div class="code-line">std::cout &lt;&lt;</div>

<div class="spacer"></div>

<textarea id="code">
tgen::sequence<int>(12,1,10)
.equal_range(0,3)
.distinct({0,4})
.gen()
</textarea>

<div class="spacer"></div>

<div class="code-line">&emsp;&emsp;&emsp;&emsp;&lt;&lt; std::endl;</div>

</div>

}

</div>





<div id="out" class="output"></div>

<script>

if (!window.__TGEN_ENGINE_LOADING__) {
    window.__TGEN_ENGINE_LOADING__ = true;

    let editor = null;
    let out = null;
    let timer = null;
    let lastCode = null;
    let wasmReady = false;
    let setString = null;   // <-- NEW

    window.Module = {
        noInitialRun: true,
        onRuntimeInitialized() {
            wasmReady = true;

            editor = document.getElementById("code");
            out = document.getElementById("out");

            // --- CONNECT C++ FUNCTIONS ---
            setString = Module.cwrap(
                "set_input_string",
                null,
                ["string"]
            );

            // textbox hookup
            const input = document.getElementById("stringBox");
            input.addEventListener("input", () => {
                setString(input.value);
                execute(); // rerun code when argument changes
            });

            // send initial value
            setString(input.value);

            // existing editor behavior
            editor.addEventListener("input", scheduleRun);

            execute();
        }
    };

    const script = document.createElement("script");
    script.src = "engine.js?v=" + Date.now();
    document.body.appendChild(script);
	let lastArg = null;

	function execute() {
		if (!wasmReady) return;

		const code = editor.value;
		const arg  = document.getElementById("stringBox").value;

		if (code === lastCode && arg === lastArg) return;

		lastCode = code;
		lastArg = arg;

		out.textContent = "Running...";

		try {
			const result = Module.ccall(
				"run",
				"string",
				["string"],
				[code]
			);
			out.textContent = result || "";
		} catch (e) {
			console.error(e);
			out.textContent = "Engine error";
		}
	}


    function scheduleRun() {
        clearTimeout(timer);
        timer = setTimeout(execute, 350);
    }

    window.run = execute;
}

</script>




</body>
</html>

