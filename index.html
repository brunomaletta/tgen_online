<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">
<style>
body{
    background:#1e1e1e;
    color:#ddd;
    font-family:Consolas,monospace;
    max-width:1000px;
    margin:auto;
    padding:30px;
}
.editor{
	    position:relative;   /* IMPORTANT: anchor for absolute children */
    background:#1e1e1e;
    border:1px solid #3c3c3c;
    border-radius:14px;
    padding:18px 18px 20px 18px;
    box-shadow:
        0 10px 30px #00000055,
        inset 0 0 0 1px #ffffff05;
    transition:all .18s ease;
}

.editor::before{
    content:"";
    display:block;
    height:1px;
    background:linear-gradient(to right, transparent, #ffffff18, transparent);
    margin:-6px 0 12px 0;
}


/* subtle highlight when interacting */
.editor:focus-within{
    border-color:#0e639c;
    box-shadow:
        0 12px 32px #00000066,
        0 0 0 1px #0e639c,
        0 0 18px #0e639c33,
        inset 0 0 0 1px #ffffff08;
}

textarea{
    width:100%;
    height:260px;
    background:transparent;        /* important */
    color:#9cdcfe;
    border:none;
    outline:none;
    resize:none;
    font-size:16px;
    box-sizing:border-box;
    font-family:Consolas, monospace;
    line-height:1.45;
}

button{
    margin-top:15px;
    padding:10px 20px;
    background:#0e639c;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
button:hover{background:#1177bb;}
.output{
    background:#000;
    color:#00ff90;
    padding:15px;
    border-radius:10px;
    margin-top:20px;
    min-height:120px;
    white-space:pre-wrap;
}
.keyword{color:#569cd6;}

.spacer{
height:12px;
}

.codebody{
    margin-left:28px;
    margin-top:6px;
}

.code-line{
    color:#dcdcaa;
    margin:4px 0;
    display:flex;
    align-items:center;
    width:100%;
}

/* the badge */
#stringBoxContainer{
    position:absolute;
    right:14px;
    top:18px;                 /* equals editor padding-top */
    height:20px;              /* first line height */
    display:flex;
    align-items:center;       /* vertical centering */
}

#stringBox{
        top:8px;      /* was 12px â€” align to first line */
	position: relative;
    background:#252526;
        color:#4fc1ff;              /* VSCode identifier blue */
    border:1px solid #3c3c3c;
    border-radius:7px;
    padding:4px 8px;
    font-family:Consolas, monospace;
    font-size:14px;
    width:210px;
    outline:none;
    transition:.15s;
}

#stringBox{
    position:relative;
    top:1px;
}

#stringBox:focus{
    border-color:#0e639c;
    box-shadow:0 0 0 1px #0e639c, 0 0 6px #0e639c44;
}



.argline{
    display:flex;
    align-items:center;
    justify-content:space-between; /* pushes input to the right */
    gap:10px;
}

.argline input{
    margin-left:auto;   /* THIS moves it to the right */
}

/* subtle IDE-style label */
.argLabel{
    color:#6a9955;          /* comment green */
    font-size:12.5px;
    font-family:Consolas, monospace;
    opacity:0.9;
    user-select:none;
}



</style>
</head>

<body>

<h2>tgen playground</h2>



<div class="editor">

<div id="stringBoxContainer">
	<span class="argLabel">Args:&emsp;</span>
	<input id="stringBox" type="text" value="./a.out" />
</div>

<span class="keyword">#include</span> <iostream><br>
<br>
<span class="keyword">#include</span> "tgen.h";<br><br>

<span class="keyword">int</span> main() {<br>

<div class="codebody">

    <div class="code-left">

        <div class="code-line">std::cout &lt;&lt;</div>

        <div class="spacer"></div>

        <textarea id="code">
tgen::sequence<int>(12,1,10)
.equal_range(0,3)
.distinct({0,4})
.gen()</textarea>

        <div class="spacer"></div>

        <div class="code-line">&emsp;&emsp;&emsp;&emsp;&lt;&lt; std::endl;</div>

    </div>

</div>


}

</div>





<div id="out" class="output"></div>

<script>

if (!window.__TGEN_ENGINE_LOADING__) {
    window.__TGEN_ENGINE_LOADING__ = true;

    let editor = null;
    let out = null;
    let timer = null;
    let lastCode = null;
    let wasmReady = false;
    let setString = null;   // <-- NEW

    window.Module = {
        noInitialRun: true,
        onRuntimeInitialized() {
            wasmReady = true;

            editor = document.getElementById("code");
            out = document.getElementById("out");

            // --- CONNECT C++ FUNCTIONS ---
            setString = Module.cwrap(
                "set_input_string",
                null,
                ["string"]
            );

            // textbox hookup
            const input = document.getElementById("stringBox");
            input.addEventListener("input", () => {
                setString(input.value);
                execute(); // rerun code when argument changes
            });

            // send initial value
            setString(input.value);

            // existing editor behavior
            editor.addEventListener("input", scheduleRun);

            execute();
        }
    };

    const script = document.createElement("script");
    script.src = "engine.js?v=" + Date.now();
    document.body.appendChild(script);
	let lastArg = null;

	function execute() {
		if (!wasmReady) return;

		const code = editor.value;
		const arg  = document.getElementById("stringBox").value;

		if (code === lastCode && arg === lastArg) return;

		lastCode = code;
		lastArg = arg;

		out.textContent = "Running...";

		try {
			const result = Module.ccall(
				"run",
				"string",
				["string"],
				[code]
			);
			out.textContent = result || "";
		} catch (e) {
			console.error(e);
			out.textContent = "Engine error";
		}
	}


    function scheduleRun() {
        clearTimeout(timer);
        timer = setTimeout(execute, 350);
    }

    window.run = execute;
}

</script>




</body>
</html>

